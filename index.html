<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>룰렛 이벤트1</title>
<script src="https://cdn.jsdelivr.net/npm/winwheel-module@2.8.1/src/winwheel.js"></script>
<style>
  body { font-family: sans-serif; text-align: center; padding: 20px; }
  #canvasContainer { margin: 20px auto; width: 400px; height: 400px; position: relative; }
  #spin { padding: 10px 20px; font-size: 18px; cursor: pointer; }
  #result { margin-top: 20px; font-weight: bold; font-size: 20px; }
</style>
</head>
<body>

<h1>룰렛 이벤트</h1>
<label>이름 (선택): <input id="name" placeholder="익명"></label>
<div id="canvasContainer">
  <canvas id="roulette" width="400" height="400"></canvas>
</div>
<button id="spin">돌리기</button>
<div id="result"></div>

<script>
const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwjV-lQAkWLIfpOekLX8Ogoou6y5zCeDH92e4UM7R62GfKDHerqkaAM4UfzTfEQb92H/exec';
const EMAIL_NOTIFY = true; // true면 이메일 알림도 가능

// 룰렛 세팅
let wheel = new Winwheel({
  'canvasId' : 'roulette',
  'numSegments' : 6,
  'segments' : [
    {'fillStyle' : '#eae56f', 'text' : '커피쿠폰'},
    {'fillStyle' : '#89f26e', 'text' : '영화예매권'},
    {'fillStyle' : '#7de6ef', 'text' : '10% 할인'},
    {'fillStyle' : '#e7706f', 'text' : '꽝'},
    {'fillStyle' : '#eae56f', 'text' : '스타벅스 기프티콘'},
    {'fillStyle' : '#89f26e', 'text' : '문화상품권'}
  ],
  'animation' : {
    'type'     : 'spinToStop',
    'duration' : 5,
    'spins'    : 8,
    'callbackFinished' : onFinished
  }
});

// 룰렛 돌리기
document.getElementById('spin').addEventListener('click', () => {
  wheel.startAnimation();
  document.getElementById('spin').disabled = true;
});

// 룰렛 종료 콜백
function onFinished(segment) {
  const name = document.getElementById('name').value || '익명';
  const prize = segment.text;
  document.getElementById('result').textContent = `축하합니다! 당첨: ${prize}`;
  
  // Google Apps Script로 전송
  const payload = { name, prize, url: location.href, time: new Date().toISOString() };
  fetch(APPS_SCRIPT_URL, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(payload)
  })
  .then(res => res.json())
  .then(console.log)
  .catch(err => console.error('전송 실패', err))
  .finally(() => document.getElementById('spin').disabled = false);
}
</script>

</body>
</html>
